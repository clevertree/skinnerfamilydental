"use strict";var _slicedToArray=function(){function t(t,e){var a=[],n=!0,i=!1,r=void 0;try{for(var o,d=t[Symbol.iterator]();!(n=(o=d.next()).done)&&(a.push(o.value),!e||a.length!==e);n=!0);}catch(c){i=!0,r=c}finally{try{!n&&d["return"]&&d["return"]()}finally{if(i)throw r}}return a}return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_monoForm={isInTool:document.body.hasAttribute("data-istool"),$forms:$(".form"),activeCaptchaForm:null,logsSource:"FORM_HCAPTCHA",init:function(){var t=this,e=this;this.$forms.each(function(t,a){e.setConditionals($(a)),e.bindLabelsClick($(a))});var a=this.$forms.find("input[data-type='datepicker']");e.isDesktop()?e.initDatepicker(a):e.initNativeDatepicker(a),e.initLocation(this.$forms.find("input[data-type='location']")),this.$forms.find("a[data-overlay-trigger]").length>0&&this.$forms.find("a[data-overlay-trigger]").monooverlay(),this.addUploadEventHandler(),window._monoLoader.utils.waitFor(function(){return t.$forms.find(".h-captcha").length},function(){window.formsInitHcaptcha=function(){window.hcaptchaInitialized||e.initHcaptcha()}},2e4,50),window._monoLoader.utils.waitFor(function(){return document.querySelectorAll('[name*="captcha-response"]').length},function(){for(var t=document.querySelectorAll('[name*="captcha-response"]'),e=0;e<t.length;e++){"g-recaptcha-response"===t[e].getAttribute("name")&&t[e].remove();var a=document.createElement("label");a.setAttribute("for",t[e].id),a.style.display="none",a.innerHTML="HCAPTCHA",t[e].parentNode.insertBefore(a,t[e])}}),e.onlyShowOneHCaptchaBadge(),this.addIOSFixForHcaptcha(),this.addFocusStyles()},addIOSFixForHcaptcha:function(){var t=this,e=/iPhone|iPad|iPod/i.test(navigator.userAgent),a=void 0,n=function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.bottom<=window.innerHeight};if(e){var i=document.querySelectorAll(".h-captcha");window.addEventListener("scroll",function(){Array.prototype.forEach.call(i,function(t){n(t)&&(a=document.documentElement.scrollTop||document.body.scrollTop)})},!1)}window.onHcaptchaSuccess=function(){if(e&&void 0!==a&&window.scrollTo(0,a),t.activeCaptchaForm){var n=t.activeCaptchaForm.getAttribute("data-widgetid");window._monoLoader.utils.waitFor(function(){return hcaptcha.getResponse(n).length},function(){$(t.activeCaptchaForm).find('[name="type"][value="comment"]').length?(t.submitComment(t.activeCaptchaForm),t.activeCaptchaForm=null):(t.submitForm(t.activeCaptchaForm),t.activeCaptchaForm=null)},2e4,100)}}},validateHcaptcha:function(t){var e=this,a=t.getAttribute("data-widgetid");hcaptcha.execute(a,{async:!0}).then(function(a){var n=a.response;n&&($(t).find('[name="type"][value="comment"]').length?(e.submitComment(t),e.activeCaptchaForm=null):(e.submitForm(t),e.activeCaptchaForm=null))})["catch"](function(t){e.logEvent(t),console.error("Hcaptcha validation error: ",t)})},submitForm:function(t){if($(t).length>0){if($(t).find(".h-captcha").attr("data-invisible")&&$(t).find(".h-captcha").attr("data-invisible").length){var e=t.getAttribute("data-widgetid");try{if(!hcaptcha.getResponse(e).length)return this.activeCaptchaForm=t,this.validateHcaptcha(t),!1}catch(a){return this.logEvent(a),console.error("Submit hCaptcha error: ",a),!1}}var n=function(t){var e=$('[name="_ha_seed"]',t).val(),a=$('[name="'+e+'"]',t),n=!1;return a&&(n=0===a.val().length),n};if(n(t)===!1)return!1;this.trimOptionsFromSelectFields(t);var i=this,r=$(t),o=i.validateFields(r);if(i.toggleLoading(r),o.valid){if(!window.FormData)return!0;var d={};r.find("input[data-type='datepicker'][type='date']").each(function(t,e){var a=new DateFormatter,n=new Date(e.value),i=$("body").attr("data-dateformat");d[e.name]=a.formatDate(n,i)});var c=r.serializeArray(),l=new FormData;if(Object.keys(d).length){var s=!0,h=!1,u=void 0;try{for(var p,f=function(){var t=_slicedToArray(p.value,2),e=t[0],a=t[1];c.find(function(t){return t.name===e}).value=a},m=Object.entries(d)[Symbol.iterator]();!(s=(p=m.next()).done);s=!0)f()}catch(a){h=!0,u=a}finally{try{!s&&m["return"]&&m["return"]()}finally{if(h)throw u}}}r.find('input[type="file"]').each(function(t,e){$.each(e.files,function(t,a){c.push({name:e.name,value:a})})}),l.append("currentUrl",window.location.href),$.each(c,function(){l.append(this.name,this.value)}),$.ajax({type:"POST",url:r.attr("data-url"),data:l,contentType:!1,processData:!1,success:function(t){if(t.match(/^\{\"redirect\":.*}$/))return t=JSON.parse(t),void(window.location=t.redirect);var e=$(t);e.find("div.thankYou").length||i.initHcaptcha(e),r.replaceWith(e),r.trigger("focus"),e.find(".h-captcha").length&&(window.hcaptchaInitialized||window.hcaptchaEngagementsInitialized||i.initHcaptcha(e)),i.onlyShowOneHCaptchaBadge(),i.bindLabelsClick(e)},error:function(t){i.toggleLoading(r),413===t.status&&i.showError("requestTooLarge",r)}}),window._mtr&&r.attr("data-track-action")&&window._mtr.track(r.attr("data-track-action"))}else i.toggleLoading(r),i.showFieldErrors(r,o.fields)}return!1},submitComment:function(t){if($(t).find(".h-captcha").attr("data-invisible")&&$(t).find(".h-captcha").attr("data-invisible").length){var e=t.getAttribute("data-widgetid");if(!hcaptcha.getResponse(e).length)return this.activeCaptchaForm=t,this.validateHcaptcha(t),!1}var a=this,n=$(t),i=window.location.href,r=a.validateFields(n);if(a.toggleLoading(n),!window.FormData)return!0;var o=n.serializeArray(),d=new FormData;return n.find('input[type="file"]').each(function(t,e){$.each(e.files,function(t,a){o.push({name:e.name,value:a})})}),$.each(o,function(){d.append(this.name,this.value)}),r.valid?($.ajax({type:"POST",url:i,data:d,contentType:!1,processData:!1,success:function(t){var e=JSON.parse(t),a="<div class='submitConfirmation'>"+e.thankyoumsg+"</div>",i=void 0;if(n.replaceWith(a),Object.keys(e).length>1&&$(".commentsList").length){var r=parseInt($("#numOfComm").text());i='<p class="smalltext commentsInfoText">'+e.created+" "+_monoLang.get("##BLOG_GENERAL_BY_LABEL##")+" "+e.author+"</p>",i+='<div class="module text">',i+='<p class="bodytext commentContent">'+e.content+"</p>",i+="</div>",$(".commentsList").append(i),$("#numOfComm").html(r+1),$("#commentsArea").hasClass("hidden")&&$("#commentsArea").removeClass("hidden")}},error:function(t){a.toggleLoading(n),413===t.status&&a.showError("requestTooLarge",n)}}),window._mtr&&window._mtr.track("comment_send")):(a.toggleLoading(n),a.showFieldErrors(n,r.fields)),!1},validateFields:function(t){var e=t.find("input, select, textarea").not(":disabled, [type=submit]"),a={valid:!0,fields:{}};e=e.filter(function(t,a){return!(("checkbox"===a.type||"radio"===a.type)&&t&&e[t-1].name===a.name)}),e.each(function(t,e){var n=$(e),i=n.attr("name").replace("[]",""),r=n.attr("type");"file"!==e.type&&n.val()&&n.val(n.val().trim()),a.fields[i]=!1,"checkbox"===r||"radio"===r?(!n.attr("data-required")||n.attr("data-required")&&(n[0].checked||n.parents(".module.form").find("[type="+n.attr("type")+"][name*="+i+"]:checked").length>0))&&(a.fields[i]=!0):"h-captcha-response"===i?n[0].value&&(a.fields[i]=!0):"select"===r?(a.fields[i]=!0,n.attr("data-required")&&$(e).children("option:first-child").is(":selected")&&(a.fields[i]="notValidSelectOption")):(!n.attr("data-required")||n.attr("data-required")&&""!==n[0].value)&&(a.fields[i]=!0,"email"===n.attr("data-type")&&n.val().length>0&&!n.val().match(/^[a-zA-Z0-9_\.\-+]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$/)&&(a.fields[i]="notValidEmail"),"phone"===n.attr("data-type")&&n.val().length>0&&!n.val().match(/^[0-9\+\s\-(),.]{1,25}$/)&&(a.fields[i]="notValidPhone"))});for(var n in a.fields)if(a.fields[n]===!1||"notValidEmail"===a.fields[n]||"notValidPhone"===a.fields[n]||"notValidSelectOption"===a.fields[n]){a.valid=!1;break}return a},toggleLoading:function(t){t.toggleClass("loading")},showError:function(t,e){var a=e.attr("id"),n=void 0;switch(e.find(".error").empty(),e.find("#errors_"+a).empty().append('<div class="errors" role="alert"></div>'),t){case"requestTooLarge":n="<p>* "+_monoLang.get("##MODULE_FORM_ERR_REQUESTTOOLARGE##").replace("%s","25MB")+"</p>"}e.find("div#errors_"+a+" .errors").append(n)},showFieldErrors:function(t,e){var a=t.attr("id"),n=void 0,i=[];t.find(".error").empty(),t.find("#errors_"+a).empty().append('<div class="errors" role="alert"></div>');for(n in e){t.find('*[name="'+n+'"]').removeClass("requiredMark");var r="span.label_"+n;if(t.find(r).removeClass("requiredMarkLabel"),e[n]!==!0)if("h-captcha-response"!==n||e[n]!==!1){var o=t.find("label[for="+a+"_"+n+"]").text(),d=t.find('*[name="'+n+'"]').attr("placeholder")||"";o||(o=t.find(r).contents().filter(function(){return 1===this.nodeType||3===this.nodeType}).text());var c=o.replace(/\s/g,"").length>0?o:d;c=c.replace(/\*$/,"").replace(/(^\s*|\s*$)/g,""),e[n]===!1&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_REQUIRED##")+"</p>"),t.find('*[name="'+n+'"]').addClass("requiredMark"),t.find(r).addClass("requiredMarkLabel"),i.push(n)),"notValidEmail"===e[n]&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_EMAIL##")+"</p>"),t.find('*[name="'+n+'"]').addClass("requiredMark")),"notValidPhone"===e[n]&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_PHONE##")+"</p>"),t.find('*[name="'+n+'"]').addClass("requiredMark")),"notValidSelectOption"===e[n]&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_SELECT_OPTION##")+"</p>"),t.find('*[name="'+n+'"]').addClass("requiredMark"))}else t.find("div#errors_"+a+"  .errors").append("<p>* "+_monoLang.get("##MODULE_FORM_ERR_HCAPTCHA##")+"</p>")}},setConditionals:function(t){var e=this,a=t.find(".conditional");a.length&&(a.not(".show").find("input, select, textarea").prop("disabled",!0),a.each(function(a,n){var i=$(n).attr("data-condition").match(/^([^,]+),(.+)$/);if(i&&3===i.length){var r=i[1],o=i[2],d=t.find('[name="'+r+'"][value="'+o+'"]').length?t.find('[name="'+r+'"][value="'+o+'"]'):t.find('[name="'+r+'[]"][value="'+o+'"]'),c=d.attr("type");d.is(":checked")&&$(n).addClass("show").find("input, select, textarea").prop("disabled",!1),"checkbox"===c?d.on("change",function(){$(this).is(":checked")?e.showHideConditional($(n)):e.showHideConditional($(n),1)}):"radio"===c&&t.find('[name="'+r+'"]').on("change",function(){this.value===o?e.showHideConditional($(n)):e.showHideConditional($(n),1)})}}))},showHideConditional:function(t,e){e?t.removeClass("show").find("input, select, textarea").prop("disabled",!0):t.addClass("show").find("input, select, textarea").prop("disabled",!1)},bindLabelsClick:function(t){var e=t.find('span[class*="label_field"], span[class*="label_optin_field"]');e.on("click",function(t){"SPAN"!==t.target.nodeName&&$(t.currentTarget).parents("optins")||("radio"===this.previousSibling.type?this.previousSibling.checked=!0:this.previousSibling.checked=!this.previousSibling.checked,$(this.previousSibling).trigger("focus"),$(this.previousSibling).trigger("change"))})},initHcaptcha:function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";try{var a=hcaptcha.render(t[0],{sitekey:t.attr("data-sitekey"),size:e});t.parents(".form").attr("data-widgetid",a),window.hcaptchaInitialized=!0}catch(n){this.logEvent(n),console.error("Initialize error: ",n)}}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$forms;e.each(function(e,a){var n=$(a).find(".h-captcha");if(!n.length)return!0;var i=n.parents("[data-animate]"),r=setInterval(function(){if($(a).width()&&(!i.length||i.is(".animationDone"))){clearInterval(r);var e=$(a).width()>304?"normal":"compact";$(a).find(".h-captcha").attr("data-invisible")&&$(a).find(".h-captcha").attr("data-invisible").length&&(e="invisible"),t(n,e)}},50)})},onlyShowOneHCaptchaBadge:function(){var t=document.querySelectorAll(".hcaptcha-badge");t.length&&$(t[t.length-1]).removeClass("hide")},initLocation:function(t){$(t).each(function(t,e){var a=!1;$(e).on("focus",function(){a||(a=new google.maps.places.Autocomplete(e))}),$(e).on("keypress",function(t){13===t.which&&t.preventDefault()})})},initDatepicker:function(t){function e(){$.fn.datetimepicker&&($.datetimepicker.setLocale(n),$(t).datetimepicker({timepicker:!1,lazyInit:!0,scrollMonth:!1,format:a}),clearInterval(i))}var a=$("body").attr("data-dateformat"),n=window._monoLoader.utils.getSiteLocale(),i=setInterval(e,200)},initNativeDatepicker:function(t){t.each(function(t,e){e.type="date"})},isDesktop:function(){return"lg"===window._monoLoader.utils.getViewport()},trimOptionsFromSelectFields:function(t){$(t).find("select")&&$(t).find("select").children().each(function(){var t=$(this).val(),e=$(this).html();$(this).val(t.trim()),$(this).html(e.trim())})},addUploadEventHandler:function(){var t=this.$forms.find("button.uploadBtn");t.each(function(t,e){var a=e.parentElement.previousElementSibling;e.addEventListener("click",function(){return a.click()}),a.addEventListener("change",function(){var t=a.files.length,n=window._monoLang.langObj.MODULE_FORM_FILESUPLOADED;e.nextElementSibling.innerHTML=1===t?a.files[0].name:t+" "+n})})},logEvent:function(t){window.dispatchEvent(new CustomEvent("errorLog",{detail:{source:this.logsSource,content:t}}))},addFocusStyles:function(){void 0!==$("body").attr("data-enablefocusindication")&&(document.addEventListener("focusin",function(t){var e=t.target.closest(".form_option"),a=t.target.nextElementSibling,n=a&&"span"===a.tagName.toLowerCase();if(e&&n&&t.target instanceof HTMLInputElement&&("radio"===t.target.type||"checkbox"===t.target.type)){var i=window.getComputedStyle(t.target),r={outline:i.outline,boxShadow:i.boxShadow,border:i.border};a.style.outline=r.outline,a.style.boxShadow=r.boxShadow,a.style.border=r.border}}),document.addEventListener("focusout",function(t){var e=t.target.closest(".form_option"),a=t.target.nextElementSibling,n=a&&"span"===a.tagName.toLowerCase();e&&n&&(a.style.outline="",a.style.boxShadow="",a.style.border="")}))}};_monoForm.init();